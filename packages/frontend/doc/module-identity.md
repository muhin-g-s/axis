# Модуль Identity

## Общая архитектура

Модуль `@/src/modules/identity/**` реализует функциональность аутентификации пользователя в приложении. Архитектура следует паттернам Clean Architecture с разделением ответственности на слои:

- **API слой** - взаимодействие с внешними сервисами
- **Сервисный слой** - бизнес-логика аутентификации  
- **Модельный слой** - определение типов и валидация данных
- **UI слой** - компоненты интерфейса пользователя
- **Hooks/Context** - предоставление зависимостей компонентам

## Структура модуля

```
identity/
├── api/                 # Внешние интеграции
│   └── login.api.ts     # Интерфейсы и реализация API
├── services/            # Бизнес-логика
│   └── login.service.ts # Сервис аутентификации
├── model/               # Типы и валидации
│   ├── login.model.ts   # Модели логина
│   └── email.model.ts   # Валидация email
├── ui/                  # Компоненты интерфейса
│   ├── components/      # Презентационные компоненты
│   │   └── LoginForm.tsx
│   └── view/            # Контейнерные компоненты
│       └── LoginPage.tsx
└── hooks/               # Предоставление зависимостей
    └── identity.context.tsx
```

## Принципы проектирования

1. **Разделение ответственности** - каждый слой имеет свою зону ответственности
2. **Зависимости направлены к доменной области** - внешние зависимости не проникают внутрь
3. **Тестирование** - использование интерфейсов позволяет легко мокать зависимости
4. **DI через Context** - зависимости передаются через React Context

## Взаимосвязи модуля

### С внешними зависимостями:
- HTTP клиент (через DI)
- Сессия аутентификации (внешний сервис хранения токена)
- Shared UI компоненты (Input, Button)

### Внутренние связи:
- `LoginPage` → `LoginForm` (рендеринг компонента)
- `LoginForm` → `useIdentityContext` (получение сервиса)
- `useIdentityContext` → `LoginService` (предоставление экземпляра)
- `LoginService` → `LoginApi` (вызов API)
- `LoginApi` → HTTP клиент (сетевой вызов)

## Архитектурные особенности приложения

### Dependency Injection
Используется через React Context в `infrastructure/di/`, что позволяет:
- Изолировать компоненты от конкретных реализаций
- Упрощает тестирование
- Позволяет централизованно управлять жизненным циклом сервисов

### Слоистая архитектура
Приложение разделено на:
- `modules` - функциональные модули (в данном случае identity)
- `shared` - переиспользуемые компоненты и утилиты
- `infrastructure` - технические детали (роутинг, конфигурация, сетевые вызовы)

### Состояние приложения
- Сессия хранится во внешнем сторе (вероятно localStorage или подобное)
- Используется паттерн Singleton для сервисов, чтобы избежать дублирования экземпляров

### Валидация
- Используется библиотека `arktype` для валидации
- Валидация происходит на уровне модели данных
- Интеграция с формами через утилиты в `shared/utils/form.ts`